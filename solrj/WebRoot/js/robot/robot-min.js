KISSY.add("robot/base/config",function(a){var b={el:{head:"#header",body:"#content",foot:"#footer",main:"#main",side:"#side",chatpanel:"#chatpanel",chatlist:"#chatlist",inputpanel:"#inputpanel",chatinput:"#chat-input",chatbtn:"#chat-btn",inputcount:"#inputcount",extpanel:"#ext-panel",applogin:"#applogin"},tpl:{question:"#tpl-question",answer:"#tpl-answer",systips:"#tpl-systips",exttips:"#tpl-exttips",exthot:"#tpl-exthot",login:"#tpl-robot-login",defaultPaging:"#tpl-default-paging"}};return{init:function(c){return a.mix(b,c,!0,["appInfo","inputSetting","appConfig","userInfo","initData"]),b},get:function(){return b}}},{attach:!1}),KISSY.add("robot/base/request",function(a,b){return function(c){var d=0;b.config({globalParam:{sourceId:c.appConfig.sourceId}}),this.ask=function(e,f){1!=d&&(d=1,e.q=encodeURI(e.q),e.sourceId=c.appConfig.sourceId,e.moduleId=c.appConfig.moduleId,b.ask(e,function(b){d=0,a.isFunction(f)&&f(b)}))},this.isAsk=function(){return 1==d?!1:!0},this.feedback=function(d,e){d.sourceId=c.appConfig.sourceId,b.feedback(d,function(b){a.isFunction(e)&&e(b)})},this.pluginExecute=function(d,e){d.sourceId=c.appConfig.sourceId,b.pluginExecute(d,function(b){a.isFunction(e)&&e(b)})},this.checkUserName=function(a,c){b.checkUserName(a,function(a){c(a)})},this.addEventListener=function(a,c){b.addEventListener(a,c)},this.removeEventListener=function(a,c){b.removeEventListener(a,c)}}},{attach:!1,requires:["sdk/robot"]}),KISSY.add("robot/config",function(a,b,c){return c.init(b)},{attach:!1,requires:["./initdata","./base/config"]}),KISSY.add("robot/init",function(a){return{init:function(b){a.add("robot/initdata",function(){return b}),a.use("robot/config,robot/ui/,robot/request,robot/logic/login",function(a,c,d,e,f){f.init(function(){a.use("robot/logic/,robot/plug",function(c,d,e){a.each(b.loadPlug,function(a){e(a.name,a.data)})})},c.appConfig.mustLogin)})}}}),KISSY.add("robot/logic/chat",function(a,b,c,d,e,f,g){var h=a.all,i=a.DOM;b.prototype._setContainerRegion=function(){var a=this,b=a.config,c=a.textInput,d=i.offset(c),e=a.container;i.css(e,{left:d.left,bottom:i.viewportHeight()-d.top+b.offset}),i.width(e,b.containerWidth||c.offsetWidth-2)},b.prototype._updateInputFromSelectItem=function(){var a=this,b=a._getSelectedItemKey(a.selectedItem)||a.query;a.textInput.value=b.replace(/<[^>]+>/g,"")},b.prototype._getSelectedItemKey=function(){var a=this,b="",c="key";return a.selectedItem?i.attr(a.selectedItem,c).replace(/<[^>]+>/g,""):b};var j=d.el,k=h(j.chatbtn),l=h(j.chatinput),m=function(a){a?(l.prop("disabled",!0),l.addClass("disabled"),l.parent().addClass("disabled")):(l.prop("disabled",!1),l.removeClass("disabled"),l.parent().removeClass("disabled"))},n="http://localhost:8081/utry_ckms/episteme_unLockKmDocument.do";"undefined"!=typeof env&&"daily"==env&&(n="http://localhost:8081/utry_ckms/episteme_unLockKmDocument.do");var o=new b(j.chatinput,n+d.appConfig.moduleId,{resultFormat:"\u7ea6%result%\u6b21\u63d0\u95ee",dataType:1}),p=function(b){o.hide();var g=l.val(),h=a.escapeHTML(l.val());if(""!=h){m(!0);var i=f.chatpanel.addQuestion(h);e.ask(a.mix({q:g,nick:encodeURI(d.userInfo.username)},b||{}),function(b){"success"==b.status?(i.one("div.time").html(c.dateFormat(new Date,"yy-mm-dd HH:MM:ss")),a.later(function(){f.chatpanel.addAnswer(b.data),f.extpanel.addAbout(b.data)},500)):i.one("div.time").html("<span class='error'>\u667a\u80fd\u6dd8\u5c0f\u4e8c\u8fde\u63a5\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5..</span>").on("click",function(){l.val(i.one(".J_content").text()),l[0].focus(),t()}),m(!1),l[0].focus()}),l.val(""),t()}},q=function(a){-13==a.keyCode&&p()},r=d.inputSetting.inputNumber,s=h(j.inputcount).text(r),t=function(){var a=l.val(),b=r-a.length;0>b&&(l.val(a.substring(0,r)),b=0),s.text(b)};s.text(r),h(j.chatinput).attr("placeholder",d.inputSetting.defaultNoticeMsg),g(j.chatinput,{top:"22px",left:"19px"}),k.on("click",function(){p()}),l.on("keyup",function(){t()}).on("focus",function(){h(this).parent().addClass("chatformfocus")}).on("blur",function(){h(this).parent().removeClass("chatformfocus")}).on("keydown",function(a){q(a)}),o.container.shim=null,o.on("beforeDataRequest",function(){this.shim=!1,this.queryParams=encodeURI(this.queryParams)}),o.on("itemSelect",function(){p({_pvf:"robotsug"})}),l.on("webkitspeechchange",function(){var b=l[0];a.later(function(){b.focus(),o.query="",o.start(),t()},100)})},{attach:!1,requires:["suggest","../util","../config","../request","../ui","../ui/placeholder"]}),KISSY.add("robot/logic/delegate",function(a,b,c,d,e,f){var g=a.all,h=d.el,i=null,j=function(a,b){for(var c=0;a=a.parent();){if(a.hasAttr(b))return a.attr(b);if(c++>10)break}return""};g(h.body).delegate("click","a.J_TopKnowledge",function(b){var d=this;if(b.halt(),!e.isAsk()||g(this).data("delayask")===!1)return void f.chatpanel.addInfo("\u6570\u636e\u8bf7\u6c42\u4e2d\uff0c\u8bf7\u7a0d\u540e..");g(this).data("delayask",!1),i=setTimeout(function(){g(d).data("delayask",!0)},500);var h=g(b.currentTarget).attr("title");if(""!=h){var k=f.chatpanel.addQuestion(h),l={q:h,logid:j(g(b.currentTarget),"data-logid")};if(g(b.currentTarget).hasAttr("data-param")){var m=a.JSON.parse(g(b.currentTarget).attr("data-param"));a.isObject(m)&&a.mix(l,m)}e.ask(l,function(b){"success"==b.status?(k.all("div.time").html(c.dateFormat(new Date,"yy-mm-dd HH:MM:ss")),a.later(function(){f.chatpanel.addAnswer(b.data),f.extpanel.addAbout(b.data)},500)):k.one("div.time").html("<span class='error'>\u667a\u80fd\u6dd8\u5c0f\u4e8c\u8fde\u63a5\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5..</span>")})}}),g(h.body).delegate("click",".J_NeedLogin",function(b){b.halt(),a.use("robot/logic/login",function(a,b){b.init(function(){},!0,!0)})}),g(h.chatlist).delegate("click","ul.J_feedback li a",function(b){var d=g(b.currentTarget),f=d.parent().parent(),h=d.parent(),i=g("<img src='http://img03.taobaocdn.com/tps/i3/T19mCQXbJdXXXXXXXX-60-9.gif'/>");d[0]&&"A"!=d[0].nodeName||(f.all("li").hide(),f.append(i),e.feedback({unReason:h.attr("data-result"),logid:j(g(b.currentTarget),"data-logid"),q:c.encode(j(g(b.currentTarget),"data-question"))},function(){a.later(function(){i.remove(),h.html("\u611f\u8c22\u4f60\u7684\u53cd\u9988 <s></s>"),h.show()},500)}))})},{requires:["suggest","../util","../config","../request","../ui"]}),KISSY.add("robot/logic/index",function(a,b){var c=a.all;c(b.el.head).one(".otherservice li a").on("click",function(a){a.halt();var d=c(this).attr("href"),e=c(b.el.chatlist+" .talk-a .J_content:last");1==e.length&&(d+=e.text()),b.appConfig.ocsBizMap&&(d+="&"+b.appConfig.ocsBizMap),window.open(d)}),c("#toolbar a").on("click",function(){var a=c(b.el.chatlist),d="",e="";a.all(".talk-item").each(function(){e+=c(this).hasClass("talk-a")?'<div class="item q">':'<div class="item a">',e+="<h3>"+c(this).all(".info-user a").attr("title")+":</h3>",e+="<div>"+c(this).all(".J_content").html()+"</div>",e+="<s>"+c(this).all(".time").html()+"</s>",e+="</div>"}),d+="<html><head>",d+='<link rel="stylesheet" type="text/css" href="http://a.tbcdn.cn/s/kissy/1.2.0/cssreset-min.css">',d+="<style>body{margin:2em;} h1{font-size:2em;} .item{margin:10px 0;padding:1em;} .q{background:#efefef;} .a{background:#F5F9FE;} .item h3{font-size:14px;} .item s{text-decoration:none;color:#ccc;}</style>",d+="</head><body>",d+="<h1>\u6dd8\u5b9d\u7f51 - \u5ba2\u670d\u673a\u5668\u4eba\u5bf9\u8bdd\u8bb0\u5f55</h1>",d+=e,d+="</body></html>",c("#msg-record").val(d),c("#save-form")[0].submit()})},{attach:!1,requires:["../config","../request","../ui","./chat","./delegate","../util"]}),KISSY.add("robot/logic/login",function(a,b,c,d){var e=a.all,f=function(a,f){var g=b.dialog({width:350,closable:!1,elCls:"new-popup "}),h=e(e(c.tpl.login).val()),i=h.one(".loginframe"),j=h.one(".userinput"),k=h.all(".J_userinput"),l=(h.all(".J_J_nomember"),h.all(".J_member"));1==f?h.all(".extfun").hide():(k.on("click",function(){i.hide(),j.show(),g.center()}),l.on("click",function(){j.hide(),i.show(),g.center()}),h.all(".J_nomember a").on("click",function(){g.destroy(),c.appConfig.type=3,c.appConfig.username=b.encode("\u6e38\u5ba2"),c.userInfo.username=b.encode("\u6e38\u5ba2"),c.userInfo.nickname="\u6e38\u5ba2",a()}),h.one(".usernamecheck").on("click",function(){var e=h.one(".cs_username").val(),f=b.encode(e);return e?void d.checkUserName({loginname:f,logintype:2},function(b){b&&b.status===!0?(g.destroy(),c.appConfig.type=2,c.appConfig.username=e,c.userInfo.username=e,c.userInfo.nickname=e,a()):alert("\u7528\u6237\u201c"+e+"\u201d\u4e0d\u5b58\u5728!")}):void alert("\u8bf7\u8f93\u5165\u7528\u6237\u540d\uff01")})),g.show(),g.get("body").html("").append(h),g.center()};return{init:function(b,d,e){e?f(b,d):1==c.appConfig.type?(a.log("robot notNeedLogin,then Config.appConfig.type="+c.appConfig.type),b()):(a.log("~~~~~~~~~~~~~~~~robot NeedLogin,then Config.appConfig.type="+c.appConfig.type),f(b,d))}}},{attach:!1,requires:["../util","../config","../request"]}),KISSY.add("robot/plug",function(a,b,c,d,e){return function(f,g){a.use("robot/plug/"+f+"/",function(a,f){f(g,b,c,d,e)})}},{attach:!1,requires:["./util","./config","./ui","./request"]}),KISSY.add("robot/request",function(a,b,c){return new c(b)},{attach:!1,requires:["./config","./base/request"]}),KISSY.add("robot/ui",function(a,b){return b},{attach:!1,requires:["./ui/index"]}),KISSY.add("robot/ui/chatpanel",function(a,b,c,d,e){function f(a){var c=a.el,d=a.tpl;this.config=a,this.parent=g(c.chatlist),this.tpl={question:g(d.question).val(),answer:g(d.answer).val(),tips:g(d.systips).val(),defaultPaging:b.getTemplate(g(d.defaultPaging).val())}}var g=a.all;return a.augment(f,a.EventTarget,{addQuestion:function(a){var b=this.config,d=g(c(this.tpl.question).render({username:b.userInfo.nickname,nickname:b.userInfo.nickname,logo:b.userInfo.logo,question:a}));return d.appendTo(this.parent),this.fire("scroll",{el:d}),d},addAnswer:function(f){var h=this,i=this.config,j=f.answer.answer;8==f.type&&(j="\u8bf7\u5173\u6ce8\u53f3\u4fa7\u7684\u76f8\u5173\u95ee\u9898\uff0c\u82e5\u90fd\u4e0d\u662f\u60a8\u60f3\u8981\u7684\uff0c\u5efa\u8bae\u60a8\u91cd\u65b0\u63d0\u95ee\u3002"),a.log("data.debug="+f.debug),f.debug&&(j+="<br></br>",j+="<br>\u5206\u8bcd\u7ed3\u679c\u4e3a\uff1a"+f.answer.segment,j+="<br>\u5b9a\u4f4d\u5230\u7684\u95ee\u9898\u662f\uff1a"+f.answer.matchedQuestion,j+="<br>\u8be5\u95ee\u9898\u5339\u914d\u5ea6\u662f\uff1a"+f.answer.score,j+="<br>\u8be5\u95ee\u9898\u5bf9\u5e94\u7684\u6807\u51c6\u95ee\u9898\u662f\uff1a"+f.answer.standardQuestion,j+="<br>\u8be5\u95ee\u9898knowledgeId\u662f\uff1a"+f.answer.knowledgeId,j+="<br>\u8be5\u95ee\u9898catId\u662f\uff1a"+f.answer.catId);var k=g(c(this.tpl.answer).render({logo:i.appInfo.logo,name:i.appInfo.name,answer:j,logid:f.logid,question:f.q}));if(k.one("div.time").text(b.dateFormat(new Date,"yy-mm-dd HH:MM:ss")),0!=k.all(".paging-node").length&&a.use("gallery/pagination/1.0/index",function(a,b){{var c=a.JSON.parse(k.all(".paging-node").attr("pagination")),d=c.pageSize,e=Math.ceil(k.all(".paging-item").length/d);new b({container:k.one(".paging-container"),pageSize:d,totalPage:e,template:h.tpl.defaultPaging,loadCurrentPage:!0,callback:function(a,b,c){k.all(".paging-item").each(function(b,c){c>=(a-1)*d&&a*d>c?b.show():b.hide()}),c(a)}})}}),f.needFeedback&&1==f.needFeedback?k.one(".J_feedback").show():k.one(".J_feedback").hide(),k.all(".J_content img").each(function(a){var b=600;a.on("load",function(){var a=g(this);this.width>b&&(this.width=b,g('<a href="'+a.attr("src")+'" target="_blank" title="\u67e5\u770b\u5927\u56fe"></a>').insertBefore(a).append(a))})}),10==f.type){var l=k.all(".dynamic-node"),m=l.attr("dynamic_code");if(l.hasAttr("special")){var n=l.attr("special");a.use("robot/dynknowledge/"+n+"/",function(a,b){new b(k,f,e)})}else k.all(".ajaxtrigger").on("click",function(c){c.halt();var d=k.all("form"),g=b.extractFormData(d,!0);k.all(".J_result").html(""),k.all(".J_result_extra").html(""),e.pluginExecute(a.merge({knowledgeId:f.answer.knowledgeId,dynamic_code:m,key:b.keys(g).join(",")},g),function(a){k.all(".J_result").html(a.data),k.all(".J_result_extra").html(a.extra)})})}return k.all("a").each(function(){g(this).on("click",function(a){var b=g(this).attr("href");if(/^\#(.+)/.test(b)){a.halt();var c=k.all('a[name="'+b.substring(1,b.length)+'"]');c.length>0&&d.scrollToElement(c[0])}})}),k.appendTo(this.parent).css({position:"relative",top:"10px",opacity:"0.5"}),this.fire("scroll",{el:k.prev()}),k.animate({top:"0px",opacity:"1"},.6,"easeBoth",function(){k.css({position:"static"})}),k},addTips:function(a){var b=this,a=g(a);a.all(".close").on("click",function(a){a.halt();var c=g(this);c.parent().hide(.3,function(){c.parent().remove(),b.fire("scroll",{el:null})})}),this.parent.append(a),this.fire("scroll",{el:a})},addInfo:function(a){this.parent.append(g('<div class="sysinfo"><i class="icon"></i>'+a+"</div>")),this.fire("scroll",{el:null})}}),f},{attach:!1,requires:["../util","template","./scroll","../request"]}),KISSY.add("robot/ui/extpanel",function(a,b){function c(b){function c(b){var d=b.one("ul"),e=d.one("li:first"),f=e.height(),g=parseInt(d.css("margin-top")),h=23,i=1.5*(f+g)/h;d.stop().animate({marginTop:-f},i,void 0,function(){e.appendTo(d),d.css("margin-top","0"),a.later(function(){c(l)},0)})}function f(){l.one("ul").height()>n&&l.one(".exthot").on("mouseenter",function(){l.one("ul").stop()}).on("mouseleave",function(){c(l)})}function g(b){j.all(".bd").hide(.3),j.all(".hd").removeClass("hdext"),b.all(".bd").show(.3),b.all(".hd").addClass("hdext"),b==l?a.later(function(){l.one("ul").height()>n&&c(l)},500):l.one("ul").stop()}var h=b.el,i=d(h.extpanel),j=i.all("div.box"),k=i.all(".tipbox"),l=d(j[0]),m=d(j[1]),n=200;g(l),a.later(function(){f()},500),l.one("div.hd").on("click",function(){g(l)}),m.one("div.hd").on("click",function(){g(m)}),this.addTips=function(a){a=e(a),k.one("div.bd").html(a),k.all("div.item:last").css({"border-width":"0px"})},this.addHot=function(a){l.one("div.bd").html(a)},this.addAbout=function(b){if(!(!b.recommonedQuestionList.length>0&&!b.serviceRouteList.length>0)){g(m);var c="";if(b.hideRecomm||b.recommonedQuestionList&&b.recommonedQuestionList.length>0&&(c+='<div class="item" data-logid="'+b.logid+'"><h4>\u76f8\u5173\u95ee\u9898</h4><ul class="list">',a.each(b.recommonedQuestionList,function(a){c+='<li data-id="'+a.knowledgeId+'"><a class="J_TopKnowledge" href="#">'+a.title+"</a></li>"}),c+="</ul></div>"),c=e(c),b.serviceRouteList){var d=[],f=[],h=[],i=[],j=[],k='<div class="item"><h4>{title}</h4><ul class="list">{content}</ul></div>';a.each(b.serviceRouteList,function(a){1==a.routeType?d.push('<li class="tel">'+a.content+"</li>"):2==a.routeType?f.push('<li class="selfhelp"><a href="'+a.link+'" target="_blank">'+a.content+"</a></li>"):3==a.routeType?h.push('<li class="other"><a href="'+a.link+'" target="_blank">'+a.content+"</a></li>"):4==a.routeType&&i.push(a.link.indexOf("service.taobao.com")>-1?'<li class="ocs"><a href="'+a.link+'" target="_blank">'+a.content+"</a></li>":'<li class="ocs"><a href="http://service.taobao.com/support/onlinecs/ocs.htm?source_id='+a.link+'" target="_blank">'+a.content+"</a></li>")}),d.length>0&&j.push(k.replace("{title}","\u5ba2\u670d\u7535\u8bdd").replace("{content}",d.join(""))),f.length>0&&j.push(k.replace("{title}","\u81ea\u52a9\u670d\u52a1").replace("{content}",f.join(""))),h.length>0&&j.push(k.replace("{title}","\u5176\u4ed6").replace("{content}",h.join(""))),i.length>0&&j.push(k.replace("{title}","\u5728\u7ebf\u5ba2\u670d").replace("{content}",i.join("")))}m.one("div.bd").html(""!=c||b.hideRecomm?c+j.join(""):"<div>\u6ca1\u6709\u76f8\u5173\u95ee\u9898\uff01</div>"),m.all("div.item:last").css({"border-width":"0px"})}},this.fire("resize")}var d=a.all,e=function(a){return a.replace(/<a[^>]*>(.*?)<\/a>/g,function(a,c){return a.replace(/>(.*?)<\/a>/g,function(){return"title='"+c+"'>"+b.subStr(c,12,"..")+"</a>"})})};return a.augment(c,a.EventTarget),c},{attach:!1,requires:["../util","anim"]}),KISSY.add("robot/ui/filldata",function(a,b,c){var d=a.all;return{init:function(a,e){var f=c.tpl,g=c.initData,h=b(d(f.exttips).val()).render({tips:g.extTips}),i=b(d(f.exthot).val()).render({list:g.extHot});if(g.sysTips&&g.sysTips.length>0){var j=b(d(f.systips).val()).render({tips:g.sysTips});a.addTips(d(j))}e.addTips(h),e.addHot(i);var k=d(c.el.head).one(".appinfo");k.html(b(d("#tpl-userinfo").val()).render(c.appInfo))}}},{attach:!1,requires:["template","../config","../util"]}),KISSY.add("robot/ui/index",function(a,b,c,d,e,f,g){var h=a.all,i=b,j=i.el,k=6==a.UA.ie,l=new c(i.el),m=d,n=new e(i),o=new f(i);return n.on("scroll",function(a){m.resize(),m.scrollToElement(a.el)}),l.resize(),m.resize(h(j.chatpanel).innerWidth(),h(j.chatpanel).innerHeight()),a.all(window).on("resize",function(){k&&m.get("container").hide(),l.resize(),m.resize(h(j.chatpanel).innerWidth(),h(j.chatpanel).innerHeight()),k&&m.get("container").show()}),g.init(n,o),{layout:c,scroll:d,chatpanel:n,extpanel:o}},{attach:!1,requires:["../config","./layout","./scroll","./chatpanel","./extpanel","./filldata"]}),KISSY.add("robot/ui/layout",function(a){var b=a.all,c=a.DOM;return function(d){var e=this;a.mix(e,{head:b(d.head),body:b(d.body),foot:b(d.foot),main:b(d.main),side:b(d.side),chatpanel:b(d.chatpanel),chatlist:b(d.chatlist),chatinput:b(d.chatinput),inputpanel:b(d.inputpanel),resize:function(){var a=c.viewportHeight()<500?500:c.viewportHeight(),b=c.viewportWidth()<950?950:c.viewportWidth(),d=10,f=a-e.head.height();e.head.width(b),e.body.width(b),e.side.height(f),e.main.height(f),e.chatpanel.height(f-e.inputpanel.height()-2*d),e.chatinput.width(e.chatpanel.width()-100)}})}},{attach:!1,requires:["sizzle"]}),KISSY.add("robot/ui/placeholder",function(a){var b=a.all,c="placeholder"in document.createElement("input"),d={focusColor:"#ccc",showColor:"#999",left:0,top:0},e=function(c,e){var f=b(c),g=a.merge(d,e||{});tip=b("<span style='position:absolute;'>"+f.attr("placeholder")+"</span>"),tip.css({top:g.top,left:g.left,color:g.showColor}).on("click",function(){f[0].focus()}),f.parent().append(tip),f.on("focus",function(){""==b(this).val()?tip.css({color:g.focusColor}):tip.hide()}).on("blur",function(){""==b(this).val()?tip.css({color:g.showColor}).show():tip.hide()}).on("keydown keyup",function(){""==b(this).val()?tip.show().css({color:g.focusColor}):tip.hide()})};return function(a,d){c||(a=b(a),!a.length>0||a.each(function(a){b(a).hasAttr("placeholder")&&e(a,d)}))}}),KISSY.add("robot/ui/scroll",function(a,b,c){var d=a.all;return new c(d(b.el.chatlist),{prefix:"clear-"})},{attach:!1,requires:["../config","index"]}),KISSY.add("robot/util",function(a,b,c,d){var e=b.all,f=/^(?:select|textarea)/i,g=/^(?:color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,h=!{toString:1}.propertyIsEnumerable("toString"),i=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toString","toLocaleString","valueOf"];return{pad:function(a,b,c){for(var d=b-a.length;d>0;)a+=c,d--;return a},dateFormat:c.Date.format,encode:function(a){return encodeURIComponent(a)},subStr:function(a,b,c){if(a.length<=b)return a;for(var d=a.split(""),e=d.length,f=[],g=0,h=0;e>h&&(/\w/g.test(d[h])?g+=.5:g++,f.push(d[h]),!(g>=b));h++);return f.join("")+(c?c:"")},dialog:function(b){var c={bodyContent:"<div class='loading'></div>",mask:!0,elCls:"clear-dialog",width:550,align:{points:["cc","cc"]},closable:!0};return new d.Dialog(a.mix(c,b||{},!0))},getUrlParam:function(a){var b=new RegExp("(^|&)"+a+"=([^&]*)(&|$)","i"),c=window.location.search.substr(1).match(b);return null!=c?decodeURIComponent(c[2]):null},extractFormData:function(b,c){var d=this,b=e(b)[0],h=a.makeArray(b.elements),i=outputData={};return h=a.filter(h,function(a){return a.name&&!a.disabled&&(a.checked||f.test(a.nodeName)||g.test(a.type))}),a.each(h,function(b){var c,d=e(b).val();return(c=i[b.name])?(c&&!a.isArray(c)&&(c=i[b.name]=[c]),void c.push.apply(c,a.makeArray(d))):void(i[b.name]=d)}),a.each(i,function(b,e){outputData[e]=c?d.encode(a.isArray(b)?b.join(","):b):a.isArray(b)?b.join(","):b}),outputData},getTemplate:function(a){return a.replace(/{{@/g,"{{#")},keys:function(a){var b,c,d=[];for(b in a)d.push(b);if(h)for(c=i.length-1;c>=0;c--)b=i[c],a.hasOwnProperty(b)&&d.push(b);return d}}},{requires:["node","calendar","overlay"]}),KISSY.add("sdk/robot/base",function(a,b,c,d){var e={},f=new b.request(d);return a.mix(e,{config:function(d){d.log&&a.isFunction(d.log)&&(b.log=d.log),!d.charset||"utf-8"!=d.charset&&"gbk"!=d.charset||(c.charset=d.charset),d.globalParam&&(c.globalParam=d.globalParam)},request:f.start,addEventListener:function(a,b){f.on(a,function(a){b(a.response)})},ask:function(a,b){f.start({interfaceName:"ask",data:a,success:function(a,c,d){b({data:a,status:c,xhr:d})},error:function(a,c){b({data:null,status:a,xhr:c})}})},feedback:function(a,b){f.start({interfaceName:"feedback",data:a,success:function(a){b(a)},error:function(){b(null)}})},pluginExecute:function(a,b){f.start({interfaceName:"pluginExecute",data:a,success:function(a){b(a)},error:function(){b(null)}})},checkUserName:function(b,c){f.start({interfaceName:"checkUserName",data:b,success:function(b,d,e){b&&1==b.success?a.isFunction(c)&&c({status:!0,data:b,textStatus:d,xhr:e}):a.isFunction(c)&&c({status:!1,data:b,textStatus:d,xhr:e})},error:function(b,d){a.isFunction(c)&&c({status:!1,data:null,textStatus:b,xhr:d})}})},notifyLogin:function(a,b){f.start({interfaceName:"notifyLogin",data:a,success:function(a){b(a)},error:function(){b(null)}})}}),e.config({log:function(){}}),e},{requires:["../utils/base","./config","./interface"]}),KISSY.add("sdk/robot/config",function(a){var b={robotConfigMap:{},urlConfig:{},dailyConfig:{common_check_user_name_url:"http://service.daily.taobao.net/support/minerva/sdk/minerva_login.do",robot_ask_url:"http://service.daily.taobao.net/support/minerva/sdk/RobotSdkAsk.do",robot_feedback_url:"http://service.daily.taobao.net/support/minerva/sdk/RobotSdkFeedback.do",notify_login_url:"http://service.daily.taobao.net/support/minerva/sdk/RobotSdkBaiduLog.do"},onlineConfig:{common_check_user_name_url:"http://service.taobao.com/support/minerva/sdk/minerva_login.do",robot_ask_url:"http://service.taobao.com/support/minerva/sdk/RobotSdkAsk.do",robot_feedback_url:"http://service.taobao.com/support/minerva/sdk/RobotSdkFeedback.do",notify_login_url:"http://service.taobao.com/support/minerva/sdk/RobotSdkBaiduLog.do"}};b.urlConfig=b.onlineConfig;try{b.urlConfig=env&&"daily"==env?b.dailyConfig:b.onlineConfig}catch(c){a.log(c)}return b}),KISSY.add("sdk/robot/interface",function(a,b,c){var d=new c.requestStore({jsonp:"callbackName",dataType:"jsonp"});return d.add("ask",{url:b.urlConfig.robot_ask_url,data:{version:"2"},jsonpCallback:"RobotAskCallback",before:function(){c.log("ask before!")},success:function(){c.log("ask successed!")}}),d.add("feedback",{url:b.urlConfig.robot_feedback_url,data:{version:"2"},jsonpCallback:"RobotFeedbackCallback",before:function(){c.log("robot_feedback before")},success:function(){c.log("robot_feedback success")}}),d.add("checkUserName",{url:b.urlConfig.common_check_user_name_url,jsonpCallback:"MinervaLoginCallback",data:{version:"2"}}),d.add("notifyLogin",{url:b.urlConfig.notify_login_url,jsonpCallback:"RobotBaiduNotifyLoginCallback",data:{version:"2"}}),d.add("pluginExecute",{url:"ajax/PlugAjax.do",jsonpCallback:"RobotPluginExecuteCallback",data:{version:"2"}}),d},{requires:["./config","../utils/base"]}),KISSY.add("sdk/utils/base",function(a,b){var c={};return a.mix(c,{log:function(b){a.log(b)},requestStore:function(b){var c={},d={dataType:"jsonp",async:!0,type:"POST",timeout:1e5};a.mix(d,b||{}),this.add=function(b,e){c[b]=a.merge(d,e)},this.get=function(a){return c[a]}},request:b}),c},{requires:["./request"]}),KISSY.add("sdk/utils/request",function(a,b){function c(a){this.API=a}return a.augment(c,a.EventTarget,{start:function(b){var c=this,d=b.interfaceName,e=c.API.get(d);if(!e)return void a.log({code:"",message:"\u4f60\u8bf7\u6c42\u7684\u63a5\u53e3'"+b.type+"'\u4e0d\u5b58\u5728"});var f=a.clone(e);a.mix(f.data,b.data),a.mix(f,b,!0,["async","type","timeout","data","jsonp","jsonpCallback","form","dataType"],!0),f.error=function(f,g){try{a.isFunction(e.error)&&e.error(f,g),a.isFunction(b.error)&&b.error(f,g)}catch(h){}c.fire(d,{response:{data:null,textStatus:f,xhr:g}})},f.success=function(f,g,h){try{a.isFunction(e.success)&&e.success(f,g,h),a.isFunction(b.success)&&b.success(f,g,h)}catch(i){}c.fire(d,{response:{data:f,textStatus:g,xhr:h}})},f.complete=function(){c.fire("complete",{response:{data:f}})},f.before&&a.isFunction(f.before)&&f.before(f.data),c.fire("before",{response:{data:f}}),c.send(f)},send:function(c){new b({scriptCharset:"utf-8",url:c.url,dataType:c.dataType||"jsonp",form:c.form,jsonp:c.jsonp,jsonpCallback:c.jsonpCallback,async:!0,data:c.data,timeout:4e3,cache:!1,error:function(b,d){a.log("request error!",b,d),c.error&&c.error(b,d)},success:function(a,b,d){c.success&&c.success(a,b,d)}})}}),c},{requires:["ajax"]}),KISSY.add("sdk/robot",function(a,b){return b},{requires:["./robot/base"]});